const v={methods:{actionStarted(){this.loading=!0},actionCompleted(t=null,e={}){this.loading=!1,t!==!1&&(this.$events.$emit("clear-selections"),this.$events.$emit("reset-action-modals"),e.success===!1?this.$toast.error(e.message||__("Action failed")):this.$toast.success(e.message||__("Action completed")),this.afterActionSuccessfullyCompleted())},afterActionSuccessfullyCompleted(){this.request()}}},y={data(){return{activeFilterBadges:{},activeFilters:{},activePreset:null,activePresetPayload:{},searchQuery:""}},computed:{activeFilterCount(){let t=Object.keys(this.activeFilters).length;return this.activeFilters.hasOwnProperty("fields")&&(t=t+Object.keys(this.activeFilters.fields).filter(e=>e!="badge").length-1),t},canSave(){return this.isDirty&&this.preferencesPrefix},isDirty(){return this.isFiltering?this.activePreset?this.activePresetPayload.query!=this.searchQuery||!_.isEqual(this.activePresetPayload.filters||{},this.activeFilters):!0:!1},isFiltering(){return!_.isEmpty(this.activeFilters)||this.searchQuery||this.activePreset},hasActiveFilters(){return this.activeFilterCount>0},searchPlaceholder(){return this.activePreset?`${__("Searching in:")} ${this.activePresetPayload.display}`:__("Search")}},methods:{searchChanged(t){this.searchQuery=t},hasFields(t){for(const e in t)if(t[e])return!0;return!1},filterChanged({handle:t,values:e},i=!0){e&&this.hasFields(e)?Vue.set(this.activeFilters,t,e):Vue.delete(this.activeFilters,t),i&&this.unselectAllItems()},filtersChanged(t){this.activeFilters={};for(const e in t){const i=t[e];this.filterChanged({handle:e,values:i},!1)}this.unselectAllItems()},filtersReset(){this.activePreset=null,this.activePresetPayload={},this.searchQuery="",this.activeFilters={},this.activeFilterBadges={}},unselectAllItems(){this.$refs.dataList&&this.$refs.dataList.clearSelections()},selectPreset(t,e){this.activePreset=t,this.activePresetPayload=e,this.searchQuery=e.query,this.filtersChanged(e.filters)},autoApplyFilters(t){if(!t)return;let e={};t.filter(i=>!_.isEmpty(i.auto_apply)).forEach(i=>{e[i.handle]=i.auto_apply}),this.activeFilters=e}}},$={props:{initialPerPage:{type:Number,default(){return Statamic.$config.get("paginationSize")}}},data(){return{perPage:this.initialPerPage,page:1}},mounted(){this.setInitialPerPage()},methods:{setInitialPerPage(){this.hasPreferences&&(this.perPage=this.getPreference("per_page")||this.initialPerPage)},changePerPage(t){t=parseInt(t),(this.hasPreferences?this.setPreference("per_page",t!=this.initialPerPage?t:null):Promise.resolve()).then(i=>{this.perPage=t,this.resetPage()})},selectPage(t){this.page=t,this.$events.$emit("clear-selections")},resetPage(){this.page=1,this.$events.$emit("clear-selections")}}},b={data(){return{preferencesPrefix:null}},computed:{hasPreferences(){return this.preferencesPrefix!==null}},methods:{preferencesKey(t){return`${this.preferencesPrefix}.${t}`},getPreference(t){return this.$preferences.get(this.preferencesKey(t))},setPreference(t,e){return this.$preferences.set(this.preferencesKey(t),e)},removePreference(t,e=null){return this.$preferences.remove(this.preferencesKey(t),e)}}};function c(t,e,i,s,a,l,u,p){var r=typeof t=="function"?t.options:t;e&&(r.render=e,r.staticRenderFns=i,r._compiled=!0),s&&(r.functional=!0),l&&(r._scopeId="data-v-"+l);var o;if(u?(o=function(n){n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!n&&typeof __VUE_SSR_CONTEXT__<"u"&&(n=__VUE_SSR_CONTEXT__),a&&a.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(u)},r._ssrRegister=o):a&&(o=p?function(){a.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:a),o)if(r.functional){r._injectStyles=o;var m=r.render;r.render=function(g,d){return o.call(d),m(g,d)}}else{var h=r.beforeCreate;r.beforeCreate=h?[].concat(h,o):[o]}return{exports:t,options:r}}const F={mixins:[v,y,$,b],props:{initialSortColumn:String,initialSortDirection:String,initialColumns:{type:Array,default:()=>[]},filters:Array,actionUrl:String},data(){return{source:null,initializing:!0,loading:!0,items:[],columns:this.initialColumns,visibleColumns:this.initialColumns.filter(t=>t.visible),sortColumn:this.initialSortColumn,sortDirection:this.initialSortDirection,meta:null,pushQuery:!1,popping:!1}},computed:{parameterMap(){return{sort:"sortColumn",order:"sortDirection",page:"page",perPage:"perPage",search:"searchQuery",filters:"activeFilterParameters",columns:"visibleColumnParameters"}},parameters:{get(){return{...Object.fromEntries(Object.entries(this.parameterMap).map(([e,i])=>[e,this[i]]).filter(([e,i])=>i!=null&&i!=="")),...this.additionalParameters}},set(t){Object.entries(this.parameterMap).forEach(([e,i])=>{t.hasOwnProperty(e)&&(this[i]=t[e])})}},activeFilterParameters:{get(){return _.isEmpty(this.activeFilters)?null:utf8btoa(JSON.stringify(this.activeFilters))},set(t){this.activeFilters=JSON.parse(utf8atob(t))}},visibleColumnParameters:{get(){return _.isEmpty(this.visibleColumns)?null:this.visibleColumns.map(t=>t.field).join(",")},set(t){this.visibleColumns=t.split(",").map(e=>this.columns.find(i=>i.field===e))}},additionalParameters(){return{}},shouldRequestFirstPage(){return this.page>1&&this.items.length===0?(this.page=1,!0):!1}},created(){this.autoApplyFilters(this.filters),this.autoApplyState(),this.request()},mounted(){this.pushQuery&&(window.history.replaceState({parameters:this.parameters},""),window.addEventListener("popstate",this.popState))},beforeDestroy(){this.pushQuery&&window.removeEventListener("popstate",this.popState)},watch:{parameters:{deep:!0,handler(t,e){e.search===t.search&&JSON.stringify(e)!==JSON.stringify(t)&&(this.request(),this.pushState())}},loading:{immediate:!0,handler(t){this.$progress.loading(this.listingKey,t)}},searchQuery(t){this.sortColumn=null,this.sortDirection=null,this.resetPage(),this.request(),this.pushState()}},methods:{request(){if(!this.requestUrl){this.loading=!1;return}this.loading=!0,this.source&&this.source.cancel(),this.source=this.$axios.CancelToken.source(),this.$axios.get(this.requestUrl,{params:this.parameters,cancelToken:this.source.token}).then(t=>{if(this.columns=t.data.meta.columns,this.activeFilterBadges={...t.data.meta.activeFilterBadges},this.items=Object.values(t.data.data),this.meta=t.data.meta,this.shouldRequestFirstPage)return this.request();this.loading=!1,this.initializing=!1,this.afterRequestCompleted(t)}).catch(t=>{this.$axios.isCancel(t)||(this.loading=!1,this.initializing=!1,!(t.request&&!t.response)&&this.$toast.error(t.response?t.response.data.message:__("Something went wrong"),{duration:null}))})},afterRequestCompleted(t){},sorted(t,e){this.sortColumn=t,this.sortDirection=e},removeRow(t){let e=t.id,i=_.indexOf(this.rows,_.findWhere(this.rows,{id:e}));this.rows.splice(i,1),this.rows.length===0&&location.reload()},popState(t){!this.pushQuery||!t.state||(this.popping=!0,this.parameters=t.state.parameters,this.$nextTick(()=>{this.popping=!1}))},pushState(){if(!this.pushQuery||this.popping)return;const t=this.parameters,e=Object.keys(this.parameterMap),i=new URLSearchParams(Object.fromEntries(e.filter(s=>t.hasOwnProperty(s)).map(s=>[s,t[s]])));window.history.pushState({parameters:t},"","?"+i.toString())},autoApplyState(){if(!this.pushQuery||!window.location.search)return;const t=new URLSearchParams(window.location.search),e=Object.fromEntries(t.entries());this.popping=!0,this.parameters=e,this.$nextTick(()=>{this.popping=!1})}}},C=null,S=null;var P=c(F,C,S,!1,null,null,null,null);const w=P.exports,O={props:{sites:{type:Array,required:!0},value:{type:String,required:!0}},computed:{site(){return _.findWhere(this.sites,{handle:this.value})}}};var x=function(){var e=this,i=e._self._c;return i("v-select",{staticClass:"text-sm",attrs:{value:e.site,clearable:!1,searchable:!1,"get-option-label":s=>e.__(s.name),options:e.sites},on:{input:function(s){return e.$emit("input",s)}}})},z=[],A=c(O,x,z,!1,null,null,null,null);const f=A.exports,U={mixins:[w],components:{SiteSelector:f},props:{createFormUrl:{type:String,required:!0},configureUrl:{type:String,default:null},initialFormConfigs:{type:Array,required:!0},initialLocalizations:{type:Array,required:!0},initialSite:{type:String,required:!0}},data(){return{rows:_.clone(this.initialFormConfigs),columns:[{label:__("Form"),field:"title"},{label:__("Lists"),field:"lists"},{label:__("Tags"),field:"tags"}],localizations:_.clone(this.initialLocalizations),site:this.initialSite}},methods:{localizationSelected(t){t.active||(this.loading=!0,this.$axios.get(t.url).then(e=>{const i=e.data;this.rows=i.formConfigs,this.localizations=i.localizations,this.site=t.handle,this.loading=!1}))},removeRow(t){const e=this.rows.indexOf(t);e>-1&&(this.rows[e].delete_url=null,this.rows[e].status="draft",this.rows[e].lists=0,this.rows[e].tags=0)}}};var q=function(){var e=this,i=e._self._c;return i("div",[i("header",{staticClass:"mb-6"},[i("div",{staticClass:"flex items-center"},[i("h1",{staticClass:"flex-1",domProps:{textContent:e._s(e.__("ActiveCampaign"))}}),e.configureUrl?i("dropdown-list",{staticClass:"rtl:ml-2 ltr:mr-2"},[i("dropdown-item",{attrs:{text:e.__("Configure"),redirect:e.configureUrl}})],1):e._e(),e.localizations.length>1?i("site-selector",{staticClass:"rtl:ml-4 ltr:mr-4",attrs:{sites:e.localizations,value:e.site},on:{input:e.localizationSelected}}):e._e(),i("a",{staticClass:"btn-primary",attrs:{href:e.createFormUrl},domProps:{textContent:e._s(e.__("Create Form"))}})],1)]),i("data-list",{attrs:{rows:e.rows,columns:e.columns}},[i("div",{staticClass:"card overflow-hidden p-0"},[i("data-list-table",{scopedSlots:e._u([{key:"cell-title",fn:function({row:s}){return[i("div",{staticClass:"flex items-center"},[i("span",{staticClass:"little-dot rtl:ml-2 ltr:mr-2",class:s.status==="published"?"bg-green-600":"bg-gray-400"}),i("a",{attrs:{href:s.edit_url}},[e._v(e._s(s.title))])])]}},{key:"actions",fn:function({row:s}){return[i("dropdown-list",[i("dropdown-item",{attrs:{text:e.__("Edit"),redirect:s.edit_url}}),s.delete_url?i("dropdown-item",{staticClass:"warning",attrs:{text:e.__("Delete")},on:{click:function(a){e.$refs[`deleter-${s.title}`][0].confirm()}}},[i("resource-deleter",{ref:`deleter-${s.title}`,attrs:{"resource-title":s.title,route:s.delete_url},on:{deleted:function(a){return e.removeRow(s)}}})],1):e._e()],1)]}}])})],1)])],1)},R=[],k=c(U,q,R,!1,null,null,null,null);const D=k.exports,L={components:{SiteSelector:f},props:{title:String,initialAction:String,initialDeleteUrl:String,initialListingUrl:String,blueprint:Object,initialMeta:Object,initialValues:Object,initialLocalizations:Array,initialSite:String,initialHasOrigin:{type:Boolean,default:!1},initialOriginValues:{type:Object,default:null},initialOriginMeta:{type:Object,default:null},initialLocalizedFields:{type:Array,default:()=>[]}},data(){return{localizing:!1,action:this.initialAction,deleteUrl:this.initialDeleteUrl,listingUrl:this.initialListingUrl,meta:_.clone(this.initialMeta),values:_.clone(this.initialValues),localizations:_.clone(this.initialLocalizations),site:this.initialSite,hasOrigin:this.initialHasOrigin,originValues:this.initialOriginValues||{},originMeta:this.initialOriginMeta||{},localizedFields:this.initialLocalizedFields,saving:!1,error:null,errors:{}}},computed:{isDirty(){return this.$dirty.has("base")},somethingIsLoading(){return!this.$progress.isComplete()},canSave(){return this.isDirty&&!this.somethingIsLoading}},methods:{clearErrors(){this.error=null,this.errors={}},save(){if(!this.canSave)return;this.saving=!0,this.clearErrors();const t=this.hasOrigin?{...this.values,_localized:this.localizedFields}:this.values;this.$axios.patch(this.action,t).then(e=>{this.saving=!1,this.$toast.success(__("Saved")),this.$refs.container.saved(),this.$emit("saved",e)}).catch(e=>this.handleAxiosError(e))},handleAxiosError(t){if(this.saving=!1,t.response&&t.response.status===422){const{message:e,errors:i}=t.response.data;this.error=e,this.errors=i,this.$toast.error(e)}else{const e=data_get(t,"response.data.message");this.$toast.error(e||t),console.log(t)}},localizationSelected(t){t.active||this.isDirty&&!confirm(__("Are you sure? Unsaved changes will be lost."))||(this.localizing=t.handle,window.history.replaceState({},"",t.url),this.$axios.get(t.url).then(e=>{const i=e.data;this.action=i.action,this.deleteUrl=i.deleteUrl,this.listingUrl=i.listingUrl,this.values=i.values,this.meta=i.meta,this.localizations=i.localizations,this.hasOrigin=i.hasOrigin,this.originValues=i.originValues||{},this.originMeta=i.originMeta||{},this.localizedFields=i.localizedFields||[],this.site=t.handle,this.localizing=!1,this.$nextTick(()=>this.$refs.container.clearDirtyState())}))},setFieldValue(t,e){this.hasOrigin&&this.desyncField(t),this.$refs.container.setFieldValue(t,e)},syncField(t){confirm(__("Are you sure? This field's value will be replaced by the value in the original entry."))&&(this.localizedFields=this.localizedFields.filter(e=>e!==t),this.$refs.container.setFieldValue(t,this.originValues[t]),this.meta[t]=this.originMeta[t])},desyncField(t){this.localizedFields.includes(t)||this.localizedFields.push(t),this.$refs.container.dirty()}},watch:{saving(t){this.$progress.loading("base-publish-form",t)}},mounted(){this.$keys.bindGlobal(["mod+s"],t=>{t.preventDefault(),this.save()})}};var E=function(){var e=this,i=e._self._c;return i("div",[i("header",{staticClass:"mb-6"},[i("div",{staticClass:"flex items-center"},[i("h1",{staticClass:"flex-1",domProps:{textContent:e._s(e.title)}}),e.deleteUrl?i("dropdown-list",{staticClass:"rtl:ml-2 ltr:mr-2"},[i("dropdown-item",{staticClass:"warning",attrs:{text:e.__("Delete Config")},on:{click:function(s){return e.$refs.deleter.confirm()}}},[i("resource-deleter",{ref:"deleter",attrs:{resourceTitle:e.title,route:e.deleteUrl,redirect:e.listingUrl}})],1)],1):e._e(),e.localizations.length>1?i("site-selector",{staticClass:"rtl:ml-4 ltr:mr-4",attrs:{sites:e.localizations,value:e.site},on:{input:e.localizationSelected}}):e._e(),i("button",{staticClass:"btn-primary min-w-100",class:{"opacity-25":!e.canSave},attrs:{disabled:!e.canSave},domProps:{textContent:e._s(e.__("Save"))},on:{click:function(s){return s.preventDefault(),e.save.apply(null,arguments)}}})],1)]),i("publish-container",{ref:"container",attrs:{name:"base",blueprint:e.blueprint,meta:e.meta,errors:e.errors,"localized-fields":e.localizedFields,"is-root":!e.hasOrigin},scopedSlots:e._u([{key:"default",fn:function({setFieldMeta:s}){return[i("publish-tabs",{attrs:{syncable:e.hasOrigin},on:{updated:e.setFieldValue,"meta-updated":s,synced:e.syncField,desynced:e.desyncField}})]}}]),model:{value:e.values,callback:function(s){e.values=s},expression:"values"}})],1)},j=[],V=c(L,E,j,!1,null,null,null,null);const Q=V.exports,M={mixins:[Fieldtype],inject:["storeName"],data(){return{fields:[]}},mounted(){this.refreshFields()},methods:{refreshFields(){this.$axios.get(cp_url("/activecampaign/merge-fields")).then(t=>{this.fields=t.data}).catch(()=>{this.fields=[]})}}};var T=function(){var e=this,i=e._self._c;return i("div",{staticClass:"activecampaign-merge-fields-fieldtype-wrapper"},[i("v-select",{attrs:{"append-to-body":"",clearable:!0,options:e.fields,reduce:s=>s.id,placeholder:e.__("Choose..."),searchable:!0},on:{input:function(s){return e.$emit("input",s)}},model:{value:e.value,callback:function(s){e.value=s},expression:"value"}})],1)},N=[],I=c(M,T,N,!1,null,null,null,null);const H=I.exports,B={mixins:[Fieldtype],inject:["storeName"],data(){return{fields:[]}},computed:{form(){return this.meta.form||""}},mounted(){this.refreshFields()},methods:{refreshFields(){this.form&&this.$axios.get(cp_url(`/activecampaign/form-fields/${this.form}`)).then(t=>{this.fields=t.data}).catch(()=>{this.fields=[]})}}};var K=function(){var e=this,i=e._self._c;return i("div",{staticClass:"statamic-form-fields-fieldtype-wrapper"},[i("v-select",{attrs:{"append-to-body":"",clearable:!0,options:e.fields,reduce:s=>s.id,placeholder:e.__("Choose..."),searchable:!0},on:{input:function(s){return e.$emit("input",s)}},model:{value:e.value,callback:function(s){e.value=s},expression:"value"}})],1)},J=[],W=c(B,K,J,!1,null,null,null,null);const X=W.exports,G={mixins:[Fieldtype],data(){return{sites:_.clone(this.value)}},watch:{sites:{handler(t){this.update(t)},deep:!0}},methods:{siteOriginOptions(t){return this.sites.filter(e=>e.handle!==t.handle).map(e=>({value:e.handle,label:__(e.name)}))},toggleSite(t,e){this.sites[t].enabled=e},setOrigin(t,e){this.sites[t].origin=e}}};var Y=function(){var e=this,i=e._self._c;return i("table",{staticClass:"grid-table"},[i("thead",[i("tr",[i("th",{attrs:{scope:"col"}},[i("div",{staticClass:"flex items-center justify-between"},[e._v(" "+e._s(e.__("Site"))+" ")])]),i("th",{attrs:{scope:"col"}},[i("div",{staticClass:"flex items-center justify-between"},[e._v(" "+e._s(e.__("Origin"))+" ")])])])]),i("tbody",e._l(e.sites,function(s,a){return i("tr",{key:s.handle},[i("td",[i("div",{staticClass:"flex items-center text-sm"},[i("toggle-input",{staticClass:"rtl:ml-4 ltr:mr-4",attrs:{value:s.enabled},on:{input:function(l){return e.toggleSite(a,l)}}}),e._v(" "+e._s(e.__(s.name))+" ")],1)]),i("td",{staticClass:"text-sm"},[i("v-select",{staticClass:"w-full",attrs:{clearable:!0,options:e.siteOriginOptions(s),reduce:l=>l.value,value:s.origin},on:{input:function(l){return e.setOrigin(a,l)}}})],1)])}),0)])},Z=[],ee=c(G,Y,Z,!1,null,null,null,null);const te=ee.exports;Statamic.booting(()=>{Statamic.$components.register("activecampaign-listing",D),Statamic.$components.register("activecampaign-publish-form",Q),Statamic.$components.register("activecampaign_merge_fields-fieldtype",H),Statamic.$components.register("statamic_form_fields-fieldtype",X),Statamic.$components.register("activecampaign_sites-fieldtype",te)});
